<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>1TikTop Hooks</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet"/>
  <style>
    /* Reset e variáveis */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --tiktok-black: #000000;
      --tiktok-dark: #161823;
      --tiktok-darker: #0f1419;
      --tiktok-red: #fe2c55;
      --tiktok-blue: #25f4ee;
      --tiktok-white: #ffffff;
      --tiktok-gray: #8a8b9b;
      --tiktok-light-gray: #f1f1f2;
      --tiktok-border: rgba(255, 255, 255, 0.1);
      --tiktok-accent: #ff0050;
      --tiktok-cyan: #00f5ff;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--tiktok-black);
      color: var(--tiktok-white);
      overflow-x: hidden;
      line-height: 1.6;
    }

    /* HEADER */
    .header {
      position: fixed; top: 0; left: 0; right: 0;
      background: linear-gradient(135deg, var(--tiktok-black), var(--tiktok-dark));
      border-bottom: 1px solid var(--tiktok-border);
      z-index: 1000; backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }
    .header-top {
      height: 72px; display: flex; align-items: center;
      justify-content: space-between; padding: 0 32px;
    }
    .logo { display: flex; align-items: center; gap: 12px; cursor: pointer; }
    .logo-icon {
      width: 32px; height: 32px;
      background: linear-gradient(135deg, var(--tiktok-red), var(--tiktok-cyan));
      border-radius: 8px; display: flex; align-items: center; justify-content: center;
      font-size: 18px; font-weight: 900; color: white;
    }
    .logo-icon img { width: 20px; height: 20px; object-fit: contain; filter: brightness(0) invert(1); }
    .logo-main {
      font-size: 28px; font-weight: 900;
      background: linear-gradient(135deg, var(--tiktok-red), var(--tiktok-cyan));
      -webkit-background-clip: text; color: transparent;
    }
    .header-actions { display: flex; align-items: center; gap: 16px; }
    .back-btn {
      background: linear-gradient(135deg, var(--tiktok-cyan), var(--tiktok-blue) 50%, var(--tiktok-red));
      background-size: 200% 200%; animation: gradient-shift 3s ease infinite;
      color: var(--tiktok-white); padding: 10px 20px; border-radius: 25px;
      font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
      text-decoration: none; transition: all .3s ease;
    }
    .back-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(37, 244, 238, 0.4);
    }

    /* SEARCH AREA */
    .header-search {
      padding: 24px 32px 28px; background: rgba(0,0,0,0.3);
      border-top: 1px solid var(--tiktok-border);
    }
    .search-container { max-width: 1400px; margin: 0 auto; }
    .search-form {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr auto;
      gap: 20px;
      align-items: end;
    }
    .form-group, .range-container { display: flex; flex-direction: column; gap: 6px; }
    .form-label {
      font-size: 12px; font-weight: 600; color: rgba(255,255,255,.9);
      text-transform: uppercase; letter-spacing: 1px;
    }
    .form-input, .select-input, #period {
      width: 100%; height: 52px; background: var(--tiktok-dark);
      border: 2px solid var(--tiktok-border); border-radius: 16px;
      padding: 0 20px; color: var(--tiktok-white);
      font-size: 16px; font-weight: 500; transition: all .3s cubic-bezier(.4,0,.2,1);
    }
    .form-input:focus, .select-input:focus, #period:focus {
      outline: none; border-color: var(--tiktok-red);
      box-shadow: 0 0 0 4px rgba(254,44,85,0.15);
      transform: translateY(-2px);
      background: rgba(22,24,35,0.8);
    }
    .form-input::placeholder { color: var(--tiktok-gray); font-weight: 400; }
    .select-input {
      cursor: pointer; appearance: none;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 12px center; background-repeat: no-repeat; background-size: 16px;
      padding-right: 40px;
    }
    #period { padding: 0 10px; }
    .range-value {
      font-size: 12px; color: var(--tiktok-white); text-align: center;
    }
    .clear-btn {
      height: 52px; padding: 0 32px;
      background: var(--tiktok-gray);
      border: none; border-radius: 16px;
      color: var(--tiktok-white); font-weight: 700; font-size: 16px;
      cursor: pointer; letter-spacing: 1px;
      transition: all .3s ease;
    }
    .clear-btn:hover { background: rgba(255,255,255,0.1); }

    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* MAIN CONTENT */
    .main-content {
      margin-top: 108px; padding: 40px 32px; min-height: calc(100vh - 108px);
    }
    .videos-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(320px,1fr));
      gap: 24px; max-width: 1400px; margin: 0 auto;
    }

    /* VIDEO CARD, LOADING, EMPTY, etc. */
    /* (mantém igual ao template anterior) */
  </style>
</head>
<body>
  <!-- Pop-up Login e Recovery (igual ao anterior, mantido sem debug) -->

  <header class="header">
    <div class="header-top">
      <div class="logo">
        <div class="logo-icon"><img src="https://icones.pro/wp-content/uploads/2021/03/logo-icone-tiktok.png" alt="TikTok"></div>
        <div class="logo-main">TikTop Hooks</div>
      </div>
      <div class="header-actions">
        <a href="https://app.tiktophooks.com/" class="back-btn">Voltar</a>
      </div>
    </div>
    <div class="header-search">
      <div class="search-container">
        <form class="search-form">
          <div class="form-group">
            <label class="form-label">Palavra-chave</label>
            <input type="text" id="keyword" class="form-input" placeholder="O que você quer descobrir?">
          </div>
          <div class="form-group">
            <label class="form-label">Região</label>
            <select id="region" class="select-input">
              <option value="">Todas</option>
              <option value="id">Indonésia</option>
              <option value="us">Estados Unidos</option>
              <option value="br">Brasil</option>
              <option value="mx">México</option>
              <option value="pk">Paquistão</option>
              <option value="ph">Filipinas</option>
              <option value="ru">Rússia</option>
              <option value="bd">Bangladesh</option>
              <option value="eg">Egito</option>
              <option value="vn">Vietnã</option>
            </select>
          </div>
          <div class="range-container">
            <label class="form-label">Período (dias)</label>
            <input type="range" id="period" min="1" max="365" value="30">
            <div class="range-value" id="periodValue">30 dias</div>
          </div>
          <div class="form-group">
            <label class="form-label">Ordenar</label>
            <select id="sortBy" class="select-input">
              <option value="">Padrão</option>
              <option value="1">Curtidas</option>
              <option value="3">Recentes</option>
            </select>
          </div>
          <button type="button" id="clearBtn" class="clear-btn">Limpar tudo</button>
        </form>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="videos-grid" id="videosGrid"></div>
    <div class="loading" id="loading" style="display: none;">
      <!-- spinner e texto -->
    </div>
  </main>

  <script>
    const LOGIN_WEBHOOK_URL = 'https://n8n-2025n8n.wjemh8.easypanel.host/webhook/0bbfaeaa-d9cb-4a4d-960c-cfedf598e547';
    const VIDEOS_WEBHOOK_URL = 'https://n8n-2025n8n.wjemh8.easypanel.host/webhook/401a80db-15a7-4886-833a-df240d641c7a';
    const RECOVERY_WEBHOOK_URL = 'https://n8n-2025n8n.wjemh8.easypanel.host/webhook/password-recovery';
    let videosData = [], filteredData = [], userId = null, autoRefreshInterval = null;

    // Cookies
    function setCookie(name,val,days){ const d=new Date(); d.setTime(d.getTime()+days*24*60*60*1000); document.cookie=`${name}=${val};expires=${d.toUTCString()};path=/`; }
    function getCookie(name){ const eq=name+'='; return document.cookie.split(';').map(c=>c.trim()).find(c=>c.startsWith(eq))?.substring(eq.length)||null; }
    function deleteCookie(name){ document.cookie=`${name}=;expires=Thu,01 Jan 1970 00:00:00 UTC;path=/`; }

    // Login
    function checkExistingLogin(){ const u=getCookie('tiktok_user_id'),e=getCookie('tiktok_user_email'); if(u&&e){ userId=u; document.getElementById('loginPopup').style.display='none'; return true;} return false; }
    document.getElementById('loginButton').addEventListener('click',async()=>{ /* igual anterior */ });
    // Recovery
    /* recuperar senha handlers iguais */

    // Helpers
    function formatNumber(n){ if(n>=1e6)return(n/1e6).toFixed(1)+'M';if(n>=1e3)return(n/1e3).toFixed(1)+'K';return n.toString(); }
    function getInitials(n){return n? n[0].toUpperCase():'?';}

    // Extrair/processar dados
    function extractVideoData(raw){ /* mesma lógica */ }
    // Render/card
    function createVideoCard(v){ /* mesma lógica */ }

    // Carregar vídeos
    async function loadVideos(){ /* igual anterior, mas sem debug */ }

    // Filtrar/dinamicamente
    function applyFilters(){
      const kw=document.getElementById('keyword').value.toLowerCase().trim();
      const rg=document.getElementById('region').value;
      const pd=parseInt(document.getElementById('period').value);
      const sb=document.getElementById('sortBy').value;
      let res=[...videosData];
      if(kw) res=res.filter(v=>v.title.toLowerCase().includes(kw)||v.author.nickname.toLowerCase().includes(kw));
      if(rg) res=res.filter(v=>v.region&&v.region.toLowerCase()===rg);
      if(pd) res=res.filter(v=> v.create_time && (Date.now()-(v.create_time*1000)) <= pd*24*60*60*1000);
      if(sb==='1') res.sort((a,b)=>b.digg_count-a.digg_count);
      else if(sb==='3') res.sort((a,b)=>b.create_time-b.create_time);
      filteredData=res; renderVideos();
    }
    document.getElementById('keyword').addEventListener('input',applyFilters);
    document.getElementById('region').addEventListener('change',applyFilters);
    document.getElementById('sortBy').addEventListener('change',applyFilters);
    document.getElementById('period').addEventListener('input',e=>{
      document.getElementById('periodValue').textContent=`${e.target.value} dias`;
      applyFilters();
    });

    // Limpar tudo
    document.getElementById('clearBtn').addEventListener('click',()=>{
      document.getElementById('keyword').value='';
      document.getElementById('region').value='';
      document.getElementById('period').value='30';
      document.getElementById('periodValue').textContent='30 dias';
      document.getElementById('sortBy').value='';
      applyFilters();
    });

    // Logout
    function logout(){ deleteCookie('tiktok_user_id'); deleteCookie('tiktok_user_email'); userId=null; clearInterval(autoRefreshInterval); document.getElementById('loginPopup').style.display='flex'; document.getElementById('email').focus(); document.getElementById('videosGrid').innerHTML=''; }
    function addLogoutButton(){
      if(getCookie('tiktok_user_id')){
        const headerActions=document.querySelector('.header-actions');
        const logoutBtn=document.createElement('button');
        logoutBtn.textContent='Sair';
        logoutBtn.className='logout-btn';
        Object.assign(logoutBtn.style,{
          background:'linear-gradient(135deg,var(--tiktok-red),var(--tiktok-accent) 50%,var(--tiktok-cyan))',
          border:'none', color:'var(--tiktok-white)', padding:'8px 16px', borderRadius:'12px',
          fontSize:'12px', fontWeight:'700', cursor:'pointer', textTransform:'uppercase', letterSpacing:'1px',
          position:'relative', overflow:'hidden', boxShadow:'0 4px 15px rgba(254,44,85,0.2)', marginLeft:'16px'
        });
        logoutBtn.addEventListener('click',logout);
        headerActions.appendChild(logoutBtn);
      }
    }

    window.addEventListener('load',()=>{
      if(checkExistingLogin()){
        loadVideos(); startAutoRefresh(); addLogoutButton();
      } else document.getElementById('email').focus();
    });
    window.addEventListener('beforeunload',()=> clearInterval(autoRefreshInterval));

    function startAutoRefresh(){ clearInterval(autoRefreshInterval); autoRefreshInterval=setInterval(loadVideos,5*60*1000); }
  </script>
</body>
</html>
