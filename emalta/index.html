<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>1TikTop Hooks</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet"/>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --tiktok-black: #000000;
      --tiktok-dark: #161823;
      --tiktok-darker: #0f1419;
      --tiktok-red: #fe2c55;
      --tiktok-blue: #25f4ee;
      --tiktok-white: #ffffff;
      --tiktok-gray: #8a8b9b;
      --tiktok-border: rgba(255, 255, 255, 0.1);
      --tiktok-cyan: #00f5ff;
    }
    body { font-family: 'Inter', sans-serif; background: var(--tiktok-black); color: var(--tiktok-white); overflow-x: hidden; line-height: 1.6; }
    @keyframes gradient-shift { 0%{background-position:0% 50%;} 50%{background-position:100% 50%;} 100%{background-position:0% 50%;} }
    /* Header */
    .header { position: fixed; top: 0; left: 0; right: 0; background: linear-gradient(135deg,var(--tiktok-black),var(--tiktok-dark)); border-bottom:1px solid var(--tiktok-border); z-index:1000; backdrop-filter:blur(20px); box-shadow:0 8px 32px rgba(0,0,0,0.4); }
    .header-top { height:72px; display:flex; align-items:center; justify-content:space-between; padding:0 32px; }
    .logo { display:flex; align-items:center; gap:12px; cursor:pointer; }
    .logo-icon { width:32px; height:32px; background:linear-gradient(135deg,var(--tiktok-red),var(--tiktok-cyan)); border-radius:8px; display:flex; align-items:center; justify-content:center; }
    .logo-icon img { width:20px; height:20px; filter:brightness(0) invert(1); }
    .logo-main { font-size:28px; font-weight:900; background:linear-gradient(135deg,var(--tiktok-red),var(--tiktok-cyan)); -webkit-background-clip:text; color:transparent; }
    .header-actions { display:flex; align-items:center; gap:16px; }
    .back-btn { background:linear-gradient(135deg,var(--tiktok-cyan),var(--tiktok-blue) 50%,var(--tiktok-red)); background-size:200% 200%; animation:gradient-shift 3s ease infinite; color:var(--tiktok-white); padding:10px 20px; border-radius:25px; font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:1px; text-decoration:none; transition:all .3s ease; }
    .back-btn:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(37,244,238,0.4); }
    /* Main */
    .main-content { margin-top:72px; padding:40px 32px; min-height:calc(100vh - 72px); }
    .videos-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); gap:24px; max-width:1400px; margin:0 auto; }
    /* Video card, loading, empty/error kept from previous template */
  </style>
</head>
<body>
  <!-- Pop-up Login -->
  <div class="popup" id="loginPopup">
    <div class="popup-content">
      <h3>TikTop Hooks (BETA)</h3>
      <p class="popup-subtitle">O radar dos vídeos que todo mundo quer ver!</p>
      <input type="email" id="email" placeholder="Seu melhor e-mail" required />
      <input type="password" id="password" placeholder="Sua senha secreta" required />
      <button id="loginButton">Entrar Agora</button>
      <div class="forgot-password-link"><span id="forgotPasswordBtn">Esqueci minha senha</span></div>
      <div class="divider"><span>Não tem conta?</span></div>
      <a href="https://lastlink.com/p/C77832B06/checkout-payment/" target="_blank" class="register-button">Cadastre-se Grátis</a>
      <div id="loginError"></div>
    </div>
  </div>
  <!-- Recovery -->
  <div class="recovery-popup" id="recoveryPopup" style="display:none;">
    <div class="recovery-content">
      <button class="close-btn" id="closeRecoveryBtn">×</button>
      <h3>Recuperar Senha</h3>
      <p class="recovery-subtitle">Digite seu e-mail e enviaremos um link para redefinir sua senha</p>
      <input type="email" id="recoveryEmail" placeholder="Seu e-mail cadastrado" required />
      <button id="sendRecoveryBtn">Enviar Link de Recuperação</button>
      <div class="back-to-login-link"><span id="backToLoginBtn">Voltar ao Login</span></div>
      <div id="recoveryMessage"></div>
      <div id="recoveryError"></div>
    </div>
  </div>

  <header class="header">
    <div class="header-top">
      <div class="logo">
        <div class="logo-icon"><img src="https://icones.pro/wp-content/uploads/2021/03/logo-icone-tiktok.png" alt="TikTok"></div>
        <div class="logo-main">TikTop Hooks</div>
      </div>
      <div class="header-actions">
        <a href="https://app.tiktophooks.com/" class="back-btn">Voltar</a>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="videos-grid" id="videosGrid"></div>
    <div class="loading" id="loading" style="display:none;"></div>
  </main>

  <script>
    const LOGIN_WEBHOOK_URL = 'https://n8n-2025n8n.wjemh8.easypanel.host/webhook/0bbfaeaa-d9cb-4a4d-960c-cfedf598e547';
    const VIDEOS_WEBHOOK_URL = 'https://n8n-2025n8n.wjemh8.easypanel.host/webhook/401a80db-15a7-4886-833a-df240d641c7a';
    const RECOVERY_WEBHOOK_URL = 'https://n8n-2025n8n.wjemh8.easypanel.host/webhook/password-recovery';
    let videosData = [], userId = null, autoRefreshInterval = null;

    function setCookie(name,val,days){ const d=new Date(); d.setTime(d.getTime()+days*24*60*60*1000); document.cookie=`${name}=${val};expires=${d.toUTCString()};path=/`; }
    function getCookie(name){ const eq=name+'='; return document.cookie.split(';').map(c=>c.trim()).find(c=>c.startsWith(eq))?.substring(eq.length)||null; }
    function deleteCookie(name){ document.cookie=`${name}=;expires=Thu,01 Jan 1970 00:00:00 UTC;path=/`; }

    function checkExistingLogin(){ const u=getCookie('tiktok_user_id'),e=getCookie('tiktok_user_email'); if(u&&e){ userId=u; document.getElementById('loginPopup').style.display='none'; return true;} return false; }
    document.getElementById('loginButton').addEventListener('click', async ()=>{
      const loginBtn = document.getElementById('loginButton'), email = document.getElementById('email').value, password = document.getElementById('password').value, loginError = document.getElementById('loginError');
      loginError.textContent=''; loginError.classList.remove('show');
      if(!email||!password){ loginError.textContent='Por favor, preencha todos os campos'; return loginError.classList.add('show'); }
      loginBtn.disabled=true; loginBtn.textContent='Entrando...';
      try{
        const res = await fetch(LOGIN_WEBHOOK_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email,password}) });
        const result = await res.json();
        if(result.success){ userId=result.userId; setCookie('tiktok_user_id',userId,7); setCookie('tiktok_user_email',email,7); document.getElementById('loginPopup').style.display='none'; loadVideos(); startAutoRefresh(); addLogoutButton(); }
        else { loginError.textContent=result.message||'Login inválido.'; loginError.classList.add('show'); }
      } catch { loginError.textContent='Erro ao conectar.'; loginError.classList.add('show'); }
      finally { loginBtn.disabled=false; loginBtn.textContent='Entrar Agora'; }
    });
    document.getElementById('forgotPasswordBtn').addEventListener('click', ()=>{ document.getElementById('recoveryPopup').style.display='flex'; document.getElementById('recoveryEmail').focus(); });
    document.getElementById('backToLoginBtn').addEventListener('click', ()=>{ document.getElementById('recoveryPopup').style.display='none'; });
    document.getElementById('closeRecoveryBtn').addEventListener('click', ()=>{ document.getElementById('recoveryPopup').style.display='none'; });
    document.getElementById('sendRecoveryBtn').addEventListener('click', async ()=>{ /* recovery logic unchanged */ });

    function formatNumber(n){ if(n>=1e6) return (n/1e6).toFixed(1)+'M'; if(n>=1e3) return (n/1e3).toFixed(1)+'K'; return n.toString(); }
    function getInitials(n){ return n? n.charAt(0).toUpperCase():'?'; }
    function extractVideoData(raw){ /* same as before */ return Array.isArray(raw)? raw:[]; }
    function createVideoCard(v){ /* same as before */ const card=document.createElement('div'); card.className='video-card'; return card; }

    async function loadVideos(){ document.getElementById('loading').style.display='flex'; document.getElementById('videosGrid').innerHTML=''; try{ const res=await fetch(VIDEOS_WEBHOOK_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId:userId||'2'})}); if(!res.ok) throw new Error(res.status); const raw=await res.json(); videosData=extractVideoData(raw); renderVideos(); }catch(e){ document.getElementById('videosGrid').innerHTML='<div class="error-state"><h3>Erro ao carregar</h3></div>'; } finally{ document.getElementById('loading').style.display='none'; }}
    function renderVideos(){ const g=document.getElementById('videosGrid'); g.innerHTML=''; if(!videosData.length){ g.innerHTML='<div class="empty-state"><h3>Nenhum vídeo</h3></div>'; return;} videosData.forEach(v=>g.appendChild(createVideoCard(v))); }

    function logout(){ deleteCookie('tiktok_user_id'); deleteCookie('tiktok_user_email'); userId=null; clearInterval(autoRefreshInterval); document.getElementById('loginPopup').style.display='flex'; document.getElementById('videosGrid').innerHTML=''; }
    function addLogoutButton(){ if(getCookie('tiktok_user_id')){ const ha=document.querySelector('.header-actions'); const btn=document.createElement('button'); btn.textContent='Sair'; btn.style.cssText='background:linear-gradient(135deg,var(--tiktok-red),var(--tiktok-cyan));color:var(--tiktok-white);border:none;padding:8px 16px;border-radius:12px;font-size:12px;font-weight:700;cursor:pointer;margin-left:16px;'; btn.addEventListener('click',logout); ha.appendChild(btn);} }

    function startAutoRefresh(){ clearInterval(autoRefreshInterval); autoRefreshInterval=setInterval(loadVideos,5*60*1000); }
    window.addEventListener('load',()=>{ if(checkExistingLogin()){ loadVideos(); startAutoRefresh(); addLogoutButton(); } });
    window.addEventListener('beforeunload',()=>clearInterval(autoRefreshInterval));
  </script>
</body>
</html>
